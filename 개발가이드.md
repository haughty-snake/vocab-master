# VocabMaster ê°œë°œ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” VocabMasterì˜ ê°œë°œ, ìœ ì§€ë³´ìˆ˜, í™•ì¥ì„ ìœ„í•œ ìƒì„¸ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ëª©ì°¨

1. [ê°œë°œ í™˜ê²½ ì„¤ì •](#ê°œë°œ-í™˜ê²½-ì„¤ì •)
2. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
3. [í•µì‹¬ ëª¨ë“ˆ ìƒì„¸](#í•µì‹¬-ëª¨ë“ˆ-ìƒì„¸)
4. [ë°ì´í„° ì €ì¥ì†Œ (Storage)](#ë°ì´í„°-ì €ì¥ì†Œ-storage)
5. [ë°ì´í„° ë³´í˜¸ ë©”ì»¤ë‹ˆì¦˜](#ë°ì´í„°-ë³´í˜¸-ë©”ì»¤ë‹ˆì¦˜)
6. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
7. [ë²„ì „ ê´€ë¦¬ ë° ë§ˆì´ê·¸ë ˆì´ì…˜](#ë²„ì „-ê´€ë¦¬-ë°-ë§ˆì´ê·¸ë ˆì´ì…˜)
8. [UI ì»´í¬ë„ŒíŠ¸](#ui-ì»´í¬ë„ŒíŠ¸)
9. [PWA ê´€ë ¨](#pwa-ê´€ë ¨)
10. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
11. [í™•ì¥ ê°€ì´ë“œ](#í™•ì¥-ê°€ì´ë“œ)

---

## ê°œë°œ í™˜ê²½ ì„¤ì •

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

- Node.js 16+ (ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ìš©)
- ëª¨ë˜ ì›¹ ë¸Œë¼ìš°ì € (Chrome 80+, Firefox 75+, Safari 13+)
- ë¡œì»¬ ì›¹ ì„œë²„ (Python, Node.js serve ë“±)

### ë¡œì»¬ ê°œë°œ ì„œë²„ ì‹¤í–‰

```bash
# Python 3
cd vocab-master
python -m http.server 8000

# Node.js
npx serve . -p 8000

# VS Code Live Server í™•ì¥ ì‚¬ìš© ê°€ëŠ¥
```

### ë°ì´í„° ë²ˆë“¤ ì¬ìƒì„±

```bash
# JSON ë°ì´í„° ìˆ˜ì • í›„ ë²ˆë“¤ ì¬ìƒì„±
node scripts/bundleData.js

# ë˜ëŠ” í†µí•© í¬ë§·ìœ¼ë¡œ ë³€í™˜
node scripts/convertToUnifiedFormat.js
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
vocab-master/
â”œâ”€â”€ index.html              # ë©”ì¸ HTML (SPA)
â”œâ”€â”€ manual.html             # ì‚¬ìš©ì ë§¤ë‰´ì–¼
â”œâ”€â”€ test.html               # ê°œë°œì í…ŒìŠ¤íŠ¸ í˜ì´ì§€
â”œâ”€â”€ architecture.html       # ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì„œ (Mermaid ë‹¤ì´ì–´ê·¸ë¨)
â”œâ”€â”€ manifest.json           # PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸
â”œâ”€â”€ sw.js                   # Service Worker
â”‚
â”œâ”€â”€ css/
â”‚   â””â”€â”€ style.css           # ì „ì²´ ìŠ¤íƒ€ì¼ (CSS Variables, ë‹¤í¬ëª¨ë“œ)
â”‚
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ app.js              # ë©”ì¸ ì•± ë¡œì§ (3000+ lines)
â”‚   â”œâ”€â”€ data.js             # ë°ì´í„° ë¡œë”©/ì²˜ë¦¬/TTS
â”‚   â”œâ”€â”€ data.bundle.js      # ë²ˆë“¤ëœ JSON ë°ì´í„°
â”‚   â”œâ”€â”€ storage.js          # localStorage ê´€ë¦¬ (Write-Verify, ë°±ì—…, ë³µêµ¬)
â”‚   â””â”€â”€ version.js          # ë²„ì „ ê´€ë¦¬/ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚
â”œâ”€â”€ data/                   # ì›ë³¸ JSON ë°ì´í„° íŒŒì¼
â”‚   â”œâ”€â”€ nouns.json
â”‚   â”œâ”€â”€ verbs.json
â”‚   â””â”€â”€ ... (14ê°œ ì¹´í…Œê³ ë¦¬)
â”‚
â”œâ”€â”€ icons/                  # PWA ì•„ì´ì½˜ (72x72 ~ 512x512)
â”‚
â””â”€â”€ scripts/                # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
    â”œâ”€â”€ bundleData.js       # JSON â†’ JS ë²ˆë“¤ ë³€í™˜
    â””â”€â”€ generateIconsCanvas.js  # PWA ì•„ì´ì½˜ ìƒì„±
```

---

## í•µì‹¬ ëª¨ë“ˆ ìƒì„¸

### 1. app.js - ì•± ë¡œì§

**ì—­í• **: UI ë Œë”ë§, ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬, í™”ë©´ ì „í™˜, í•™ìŠµ ëª¨ë“œ ê´€ë¦¬

**ì£¼ìš” ì „ì—­ ë³€ìˆ˜**:
```javascript
let currentCategory = 'all';     // í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬
let currentView = 'home-view';   // í˜„ì¬ í™”ë©´ (home/list/flashcard/blink/quiz)
let currentIndex = 0;            // í”Œë˜ì‹œì¹´ë“œ/ë¸”ë§í¬ í˜„ì¬ ì¸ë±ìŠ¤
let filteredWords = [];          // í•„í„°ë§ëœ ë‹¨ì–´ ëª©ë¡
let quizQuestions = [];          // í€´ì¦ˆ ë¬¸ì œ ëª©ë¡
```

**í•µì‹¬ í•¨ìˆ˜**:

| í•¨ìˆ˜ | ì„¤ëª… |
|------|------|
| `initApp()` | ì•± ì´ˆê¸°í™” (ì¹´í…Œê³ ë¦¬ ê²€ì¦, ë Œë”ë§) |
| `showView(viewId)` | í™”ë©´ ì „í™˜ |
| `renderCategories()` | í™ˆ í™”ë©´ ì¹´í…Œê³ ë¦¬ ì¹´ë“œ ë Œë”ë§ |
| `updateFlashcard()` | í”Œë˜ì‹œì¹´ë“œ ì—…ë°ì´íŠ¸ |
| `startQuiz()` | í€´ì¦ˆ ì‹œì‘ |
| `handleImport(event)` | ë°±ì—… íŒŒì¼ ê°€ì ¸ì˜¤ê¸° |

### 2. data.js - ë°ì´í„° ê´€ë¦¬

**ì—­í• **: ì •ì  ë°ì´í„° ë¡œë”©, ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬ í†µí•©, TTS ê¸°ëŠ¥

**VocabData ê°ì²´ êµ¬ì¡°**:
```javascript
const VocabData = {
    categories: [],      // ëª¨ë“  ì¹´í…Œê³ ë¦¬ (ê¸°ë³¸ + ì‚¬ìš©ì)
    allWords: [],        // ëª¨ë“  ë‹¨ì–´ (í‰ë©´ ë°°ì—´)
    loaded: false,       // ë¡œë”© ì™„ë£Œ ì—¬ë¶€

    tts: {               // TTS ì„¤ì •
        synth: window.speechSynthesis,
        voice: null,
        rate: 0.9
    },

    // ì£¼ìš” ë©”ì„œë“œ
    async loadAll() { },           // ë°ì´í„° ë¡œë”©
    loadCustomCategories() { },    // ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬ ë¡œë”©
    reloadCustomCategories() { },  // ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬ ìƒˆë¡œê³ ì¹¨
    getWordsByCategory(id) { },    // ì¹´í…Œê³ ë¦¬ë³„ ë‹¨ì–´ ì¡°íšŒ
    speak(text, lang) { }          // TTS ìŒì„± ì½ê¸°
};
```

### 3. storage.js - ì €ì¥ì†Œ ê´€ë¦¬ (í•µì‹¬!)

**ì—­í• **: localStorage/sessionStorage ê´€ë¦¬, ë°ì´í„° ë³´í˜¸, ë°±ì—…/ë³µêµ¬

**Storage ê°ì²´ êµ¬ì¡°**:
```javascript
const Storage = {
    // ì €ì¥ì†Œ í‚¤
    KEYS: {
        PROGRESS: 'vocabmaster_progress',
        SETTINGS: 'vocabmaster_settings',
        STATS: 'vocabmaster_stats',
        CUSTOM_CATEGORIES: 'vocabmaster_custom_categories',
        BACKUP_INFO: 'vocabmaster_backup_info',
        DISABLED_CATEGORIES: 'vocabmaster_disabled_categories',
        TEMP: 'vocabmaster_temp'  // sessionStorageìš©
    },

    // ë°±ì—… í‚¤ (Write-Verify íŒ¨í„´ìš©)
    BACKUP_KEYS: {
        PROGRESS: 'vocabmaster_progress_backup',
        STATS: 'vocabmaster_stats_backup',
        CUSTOM_CATEGORIES: 'vocabmaster_custom_categories_backup'
    },

    // ë°ì´í„°
    progress: {},           // ë‹¨ì–´ë³„ í•™ìŠµ ìƒíƒœ {wordId: 'new'|'learning'|'memorized'}
    settings: {             // ì•± ì„¤ì •
        darkMode: false,
        showPronunciation: true,
        debugMode: {        // ë””ë²„ê·¸ ëª¨ë“œ ì„¤ì •
            enabled: false,
            showTestPage: false,
            showArchitecturePage: false
        }
        // ...
    },
    stats: { ... },         // í•™ìŠµ í†µê³„
    customCategories: [],   // ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬
    disabledCategories: [], // ë¹„í™œì„±í™” ì¹´í…Œê³ ë¦¬ ID

    // ìƒíƒœ í”Œë˜ê·¸
    initialized: false,     // ì´ˆê¸°í™” ì™„ë£Œ ì—¬ë¶€
    _hadDataBefore: false,  // ì´ì „ì— ë°ì´í„°ê°€ ìˆì—ˆëŠ”ì§€ (ë³µêµ¬ ëª¨ë‹¬ìš©)
    _unrecoverable: false,  // ë³µêµ¬ ë¶ˆê°€ ìƒíƒœì¸ì§€
    _loadStatus: {          // ê° ë°ì´í„° íƒ€ì… ë¡œë“œ ìƒíƒœ
        progress: 'empty',  // 'empty' | 'loaded' | 'recovered' | 'corrupted'
        settings: 'empty',
        stats: 'empty',
        customCategories: 'empty',
        disabledCategories: 'empty'
    },

    // ì£¼ìš” ë©”ì„œë“œ
    saveWithBackup(mainKey, backupKey, data) { },  // Write-Verify ì €ì¥
    restoreFromBackup(mainKey, backupKey) { },     // ë°±ì—…ì—ì„œ ë³µêµ¬
    loadWithRecovery(mainKey, backupKey, tempKey) { },  // ìš°ì„ ìˆœìœ„ ë³µêµ¬ ë¡œë“œ
    showRecoveryModal() { },                       // ë³µêµ¬ ë¶ˆê°€ ëª¨ë‹¬
    debugLog(message) { },                         // ë””ë²„ê·¸ ëª¨ë“œ ë¡œê¹…

    // ë©€í‹°íƒ­ ë™ê¸°í™” ë©”ì„œë“œ
    setupStorageEventListener() { },               // storage ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹
    reloadProgressFromStorage() { },               // ì§„í–‰ë¥  ì¬ë¡œë“œ
    reloadStatsFromStorage() { },                  // í†µê³„ ì¬ë¡œë“œ
    reloadCustomCategoriesFromStorage() { },       // ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬ ì¬ë¡œë“œ
    reloadSettingsFromStorage() { },               // ì„¤ì • ì¬ë¡œë“œ
    _mergeProgress(base, overlay) { },             // ì§„í–‰ë¥  ë¨¸ì§€ (ë†’ì€ ìƒíƒœ ìœ ì§€)

    // ë°ì´í„° ì••ì¶• ë©”ì„œë“œ (LZ-String)
    compress(data) { },                            // LZ-String UTF-16 ì••ì¶•
    decompress(raw) { },                           // ìë™ í˜•ì‹ ê°ì§€ ë° í•´ì œ
    saveCompressed(key, data) { },                 // ì••ì¶• ì„¤ì •ì— ë”°ë¼ ì €ì¥
    loadCompressed(key) { },                       // ìë™ í˜•ì‹ ê°ì§€ ë¡œë“œ
    migrateCompression(enableCompression) { },    // ì••ì¶• ì„¤ì • ë³€ê²½ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜
    getCompressionStats() { },                     // ì••ì¶•ë¥  í†µê³„ ê³„ì‚°

    // ì„¤ì • ì´ˆê¸°í™”
    resetSettings() { }                            // ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
};
```

### 4. version.js - ë²„ì „ ê´€ë¦¬

**ì—­í• **: ì‹œë©˜í‹± ë²„ì €ë‹, ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

```javascript
const Version = {
    CURRENT: '1.0.0',

    compare(v1, v2) { },      // ë²„ì „ ë¹„êµ (-1, 0, 1)
    isValid(version) { },      // ë²„ì „ ìœ íš¨ì„± ê²€ì‚¬
    normalize(version) { },    // êµ¬ë²„ì „ í˜•ì‹ ë³€í™˜
    isCompatible(version) { }, // í˜¸í™˜ì„± ê²€ì‚¬
    migrate(data, from) { }    // ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
};
```

---

## ë°ì´í„° ì €ì¥ì†Œ (Storage)

### localStorage í‚¤ êµ¬ì¡°

| í‚¤ | íƒ€ì… | ì„¤ëª… |
|----|------|------|
| `vocabmaster_progress` | Object | `{wordId: 'new'|'learning'|'memorized'}` |
| `vocabmaster_settings` | Object | ë‹¤í¬ëª¨ë“œ, ë°œìŒí‘œì‹œ, UI ì„¤ì • ë“± |
| `vocabmaster_stats` | Object | í•™ìŠµ í†µê³„ (ì´ í•™ìŠµìˆ˜, ì—°ì†ì¼ ë“±) |
| `vocabmaster_custom_categories` | Array | ì‚¬ìš©ì ì •ì˜ ì¹´í…Œê³ ë¦¬ |
| `vocabmaster_disabled_categories` | Array | ë¹„í™œì„±í™”ëœ ì¹´í…Œê³ ë¦¬ ID |
| `vocabmaster_backup_info` | Object | ë°±ì—… ë‚ ì§œ ì •ë³´ |

### sessionStorage í‚¤ êµ¬ì¡° (ì„ì‹œ ì €ì¥ìš©)

| í‚¤ | ìš©ë„ |
|----|------|
| `vocabmaster_temp_progress` | corrupted ìƒíƒœì—ì„œ í•™ìŠµ ì§„ë„ ì„ì‹œ ì €ì¥ |
| `vocabmaster_temp_stats` | corrupted ìƒíƒœì—ì„œ í†µê³„ ì„ì‹œ ì €ì¥ |
| `vocabmaster_temp_custom_categories` | corrupted ìƒíƒœì—ì„œ ì¹´í…Œê³ ë¦¬ ì„ì‹œ ì €ì¥ |

---

## ë°ì´í„° ë³´í˜¸ ë©”ì»¤ë‹ˆì¦˜

VocabMasterëŠ” **Write-Verify íŒ¨í„´**ê³¼ **ë‹¤ì¤‘ ë°±ì—… ì‹œìŠ¤í…œ**ìœ¼ë¡œ ë°ì´í„° ì•ˆì „ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

### ì €ì¥ì†Œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    localStorage (ì˜êµ¬ ì €ì¥)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Main Data                    â”‚  Backup Data                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  vocabmaster_progress         â”‚  vocabmaster_progress_backup    â”‚
â”‚  vocabmaster_stats            â”‚  vocabmaster_stats_backup       â”‚
â”‚  vocabmaster_custom_categoriesâ”‚  vocabmaster_custom_categories_backup â”‚
â”‚  vocabmaster_settings         â”‚  (ë°±ì—… ì—†ìŒ - ì¤‘ìš”ë„ ë‚®ìŒ)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   sessionStorage (ì„¸ì…˜ í•œì •)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  vocabmaster_temp: ì‹¤ì‹œê°„ ì§„í–‰ ìŠ¤ëƒ…ìƒ· (ë§ˆì§€ë§‰ ë³µêµ¬ ìˆ˜ë‹¨)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Write-Verify íŒ¨í„´

ì €ì¥ ì‹œ ë¬´ê²°ì„±ì„ ê²€ì¦í•˜ëŠ” í•µì‹¬ íŒ¨í„´ì…ë‹ˆë‹¤:

```javascript
saveWithBackup(mainKey, backupKey, data) {
    const serialized = JSON.stringify(data);
    try {
        // 1. ì“°ê¸° (Write)
        localStorage.setItem(mainKey, serialized);

        // 2. ì½ê¸° + ê²€ì¦ (Verify)
        const readBack = localStorage.getItem(mainKey);
        JSON.parse(readBack);  // íŒŒì‹± ê°€ëŠ¥í•œì§€ í™•ì¸

        // 3. ê²€ì¦ ì„±ê³µ â†’ ë°±ì—… ê°±ì‹ 
        if (backupKey) {
            localStorage.setItem(backupKey, serialized);
        }
        return true;
    } catch (e) {
        // 4. ê²€ì¦ ì‹¤íŒ¨ â†’ ë°±ì—…ì—ì„œ ë³µêµ¬ ì‹œë„
        if (backupKey) {
            this.restoreFromBackup(mainKey, backupKey);
        }
        return false;
    }
}
```

### ë³µêµ¬ ìš°ì„ ìˆœìœ„ ì‹œìŠ¤í…œ

ë°ì´í„° ë¡œë“œ ì‹œ ë‹¤ìŒ ìˆœì„œë¡œ ë³µêµ¬ë¥¼ ì‹œë„í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    loadWithRecovery() íë¦„                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1ìˆœìœ„: Main ë°ì´í„° (localStorage ë©”ì¸ í‚¤)                       â”‚
â”‚         â†’ ì •ìƒì´ë©´ ì‚¬ìš©, source = 'main'                         â”‚
â”‚                                                                  â”‚
â”‚  2ìˆœìœ„: Backup ë°ì´í„° (localStorage ë°±ì—… í‚¤)                     â”‚
â”‚         â†’ Main ì†ìƒ/ì—†ìŒ ì‹œ ë³µêµ¬, source = 'backup'              â”‚
â”‚         â†’ Mainì—ë„ ë³µì› (ìë™ ë³µêµ¬)                               â”‚
â”‚                                                                  â”‚
â”‚  3ìˆœìœ„: Temp ë°ì´í„° (sessionStorage)                             â”‚
â”‚         â†’ ë‘˜ ë‹¤ ì†ìƒ/ì—†ìŒ ì‹œ ë³µêµ¬, source = 'temp'               â”‚
â”‚                                                                  â”‚
â”‚  4ìˆœìœ„: ë³µêµ¬ ë¶ˆê°€                                                 â”‚
â”‚         â†’ hadData=trueë©´ ë³µêµ¬ ëª¨ë‹¬ í‘œì‹œ                          â”‚
â”‚         â†’ hadData=falseë©´ ì´ˆê¸° ìƒíƒœ (ì‹ ê·œ ì‚¬ìš©ì)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë³µêµ¬ ë¶ˆê°€ ëª¨ë‹¬

ëª¨ë“  ë³µêµ¬ê°€ ì‹¤íŒ¨í•˜ê³ , ì´ì „ì— ë°ì´í„°ê°€ ìˆì—ˆë˜ ê²½ìš°ì—ë§Œ í‘œì‹œë©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   âš ï¸ ë°ì´í„° ë³µêµ¬ ì‹¤íŒ¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì €ì¥ëœ í•™ìŠµ ë°ì´í„°ë¥¼ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.                         â”‚
â”‚  ì•„ë˜ ì˜µì…˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:                               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ ğŸ“ ë°±ì—… ê°€ì ¸ì˜¤ê¸°   â”‚  â”‚ ğŸ”„ ì´ˆê¸° ìƒíƒœë¡œ ì‹œì‘ â”‚                   â”‚
â”‚  â”‚                   â”‚  â”‚                   â”‚                   â”‚
â”‚  â”‚ ì´ì „ì— ë‚´ë³´ë‚¸     â”‚  â”‚ ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤.   â”‚                   â”‚
â”‚  â”‚ íŒŒì¼ì—ì„œ ë³µì›     â”‚  â”‚ (ëª¨ë“  ì§„í–‰ ì´ˆê¸°í™”) â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° ë³´í˜¸ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì•± ì‹œì‘ (init)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. loadSettings() - ì„¤ì • ë¡œë“œ                                   â”‚
â”‚     (ë””ë²„ê·¸ ëª¨ë“œ ì„¤ì • í¬í•¨)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. loadWithRecovery(progress, backup, temp)                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     â”‚ Main í™•ì¸ â†’ Backup í™•ì¸ â†’ Temp í™•ì¸ â†’ hadData ì²´í¬       â”‚â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚     â†’ source: 'main' | 'backup' | 'temp' | 'none'               â”‚
â”‚     â†’ ë””ë²„ê·¸ ëª¨ë“œ ì‹œ ë³µêµ¬ ì•Œë¦¼ í‘œì‹œ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ê°™ì€ ë°©ì‹ìœ¼ë¡œ stats, customCategories ë¡œë“œ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. checkAndWarnCorruptedData()                                  â”‚
â”‚     - _unrecoverable = true â†’ ë³µêµ¬ ë¶ˆê°€ ëª¨ë‹¬ í‘œì‹œ                â”‚
â”‚     - ë””ë²„ê·¸ ëª¨ë“œ & corrupted â†’ ë””ë²„ê·¸ ì•Œë¦¼ í‘œì‹œ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ì‚¬ìš©ì í•™ìŠµ (ë°ì´í„° ë³€ê²½)                                     â”‚
â”‚     saveProgress() / saveStats() / saveCustomCategories()       â”‚
â”‚                   â”‚                                              â”‚
â”‚                   â–¼                                              â”‚
â”‚     saveWithBackup(mainKey, backupKey, data)                    â”‚
â”‚     - Write-Verify íŒ¨í„´ìœ¼ë¡œ ì €ì¥                                 â”‚
â”‚     - ê²€ì¦ ì„±ê³µ ì‹œ ë°±ì—…ë„ ê°±ì‹                                    â”‚
â”‚     - ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë°±ì—…ì—ì„œ ë³µêµ¬                                 â”‚
â”‚                   â”‚                                              â”‚
â”‚                   â–¼                                              â”‚
â”‚     sessionStorageì— temp ìŠ¤ëƒ…ìƒ· ì €ì¥ (ë§ˆì§€ë§‰ ë³µêµ¬ ìˆ˜ë‹¨)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë””ë²„ê·¸ ëª¨ë“œ

ê°œë°œììš© ë””ë²„ê·¸ ëª¨ë“œë¥¼ í†µí•´ ë°ì´í„° ë³´í˜¸ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
// ì„¤ì •ì—ì„œ í™œì„±í™”
Storage.settings.debugMode = {
    enabled: true,           // ë””ë²„ê·¸ ì•Œë¦¼ í‘œì‹œ
    showTestPage: true,      // í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë§í¬ í‘œì‹œ
    showArchitecturePage: true  // ì•„í‚¤í…ì²˜ í˜ì´ì§€ ë§í¬ í‘œì‹œ
};

// ë””ë²„ê·¸ ë¡œê·¸ ì¶œë ¥
Storage.debugLog(message);   // ë””ë²„ê·¸ ëª¨ë“œì¼ ë•Œë§Œ ë¡œê·¸ + ì•Œë¦¼ í‘œì‹œ
```

#### ë””ë²„ê·¸ ì•Œë¦¼ í•­ëª©
- ë°ì´í„° ìë™ ë³µêµ¬ ì‹œ ì•Œë¦¼ (ì˜ˆ: "ë°±ì—…ì—ì„œ ë³µêµ¬ë¨")
- Write-Verify íŒ¨í„´ ì‹¤íŒ¨ ê°ì§€
- ì €ì¥ì†Œ ìƒíƒœ ë³€ê²½ ì•Œë¦¼

### ë©€í‹°íƒ­ ë™ê¸°í™”

ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì‹œì— ì•±ì„ ì‚¬ìš©í•  ë•Œ ë°ì´í„° ì¶©ëŒì„ ë°©ì§€í•©ë‹ˆë‹¤.

#### Storage ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹

ë‹¤ë¥¸ íƒ­ì—ì„œ localStorageë¥¼ ë³€ê²½í•˜ë©´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ í˜„ì¬ íƒ­ì˜ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•©ë‹ˆë‹¤:

```javascript
// storage.js
setupStorageEventListener() {
    window.addEventListener('storage', (event) => {
        // vocabmaster_ í‚¤ë§Œ ì²˜ë¦¬, ë°±ì—… í‚¤ëŠ” ë¬´ì‹œ
        if (!event.key || !event.key.startsWith('vocabmaster_')) return;
        if (event.key.includes('_backup')) return;

        this.debugLog(`[ë©€í‹°íƒ­] ë‹¤ë¥¸ íƒ­ì—ì„œ ë³€ê²½ ê°ì§€: ${event.key}`);

        switch (event.key) {
            case this.KEYS.PROGRESS:
                this.reloadProgressFromStorage();
                break;
            case this.KEYS.STATS:
                this.reloadStatsFromStorage();
                break;
            case this.KEYS.CUSTOM_CATEGORIES:
                this.reloadCustomCategoriesFromStorage();
                break;
            case this.KEYS.SETTINGS:
                this.reloadSettingsFromStorage();
                break;
        }
    });
}
```

#### Read-Modify-Write íŒ¨í„´

ì €ì¥ ì „ì— localStorageì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ì½ì–´ ë¨¸ì§€ í›„ ì €ì¥í•©ë‹ˆë‹¤:

```javascript
// storage.js saveProgress() ì˜ˆì‹œ
saveProgress() {
    // 1. Read: localStorageì—ì„œ ìµœì‹  ë°ì´í„° ì½ê¸°
    let dataToSave = this.progress;
    try {
        const latestRaw = localStorage.getItem(this.KEYS.PROGRESS);
        if (latestRaw) {
            const latestData = JSON.parse(latestRaw);
            // 2. Modify: í˜„ì¬ ë©”ëª¨ë¦¬ ë°ì´í„°ì™€ ë¨¸ì§€ (ë†’ì€ ìƒíƒœ ìœ ì§€)
            dataToSave = this._mergeProgress(latestData, this.progress);
            this.progress = dataToSave;
        }
    } catch (e) {
        // íŒŒì‹± ì‹¤íŒ¨ì‹œ í˜„ì¬ ë°ì´í„° ì‚¬ìš©
    }

    // 3. Write: Write-Verify íŒ¨í„´ìœ¼ë¡œ ì €ì¥
    const success = this.saveWithBackup(
        this.KEYS.PROGRESS,
        this.BACKUP_KEYS.PROGRESS,
        dataToSave
    );
}
```

#### Progress ë¨¸ì§€ ë¡œì§

ë™ì¼ ë‹¨ì–´ì˜ ìƒíƒœê°€ ì¶©ëŒí•˜ë©´ ë” ë†’ì€ í•™ìŠµ ìƒíƒœë¥¼ ìœ ì§€í•©ë‹ˆë‹¤:

```javascript
// storage.js
_mergeProgress(base, overlay) {
    const merged = { ...base };
    const statusPriority = { 'new': 0, 'learning': 1, 'memorized': 2 };

    for (const wordId in overlay) {
        const baseStatus = base[wordId] || 'new';
        const overlayStatus = overlay[wordId];

        // ë” ë†’ì€ ìƒíƒœ ìœ ì§€ (new < learning < memorized)
        if ((statusPriority[overlayStatus] || 0) >= (statusPriority[baseStatus] || 0)) {
            merged[wordId] = overlayStatus;
        }
    }

    return merged;
}
```

#### ë©€í‹°íƒ­ ë™ê¸°í™” ê´€ë ¨ í•¨ìˆ˜

| í•¨ìˆ˜ | ì—­í•  |
|------|------|
| `setupStorageEventListener()` | storage ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ |
| `reloadProgressFromStorage()` | ì§„í–‰ë¥  ë°ì´í„° ì¬ë¡œë“œ + UI ê°±ì‹  |
| `reloadStatsFromStorage()` | í†µê³„ ë°ì´í„° ì¬ë¡œë“œ |
| `reloadCustomCategoriesFromStorage()` | ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬ ì¬ë¡œë“œ + UI ê°±ì‹  |
| `reloadSettingsFromStorage()` | ì„¤ì • ì¬ë¡œë“œ |
| `_mergeProgress(base, overlay)` | ì§„í–‰ë¥  ë¨¸ì§€ (ë†’ì€ ìƒíƒœ ìœ ì§€) |

### ë°ì´í„° ì••ì¶• (LZ-String)

localStorage ìš©ëŸ‰ ìµœì í™”ë¥¼ ìœ„í•œ ì„ íƒì  ì••ì¶• ê¸°ëŠ¥ì…ë‹ˆë‹¤.

#### ì••ì¶•/í•´ì œ í•¨ìˆ˜

```javascript
// storage.js
compress(data) {
    if (typeof LZString === 'undefined') {
        return JSON.stringify(data);  // ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìœ¼ë©´ JSON í´ë°±
    }
    const json = JSON.stringify(data);
    const compressed = LZString.compressToUTF16(json);
    return 'LZ:' + compressed;  // ì ‘ë‘ì‚¬ë¡œ í˜•ì‹ í‘œì‹œ
}

decompress(raw) {
    if (!raw) return null;

    // LZ-String í˜•ì‹ ê°ì§€ (ì ‘ë‘ì‚¬ 'LZ:')
    if (raw.startsWith('LZ:')) {
        const compressed = raw.substring(3);
        const json = LZString.decompressFromUTF16(compressed);
        return JSON.parse(json);
    }

    // JSON í˜•ì‹ ê°ì§€
    if (raw.startsWith('{') || raw.startsWith('[')) {
        return JSON.parse(raw);
    }

    return null;  // ì•Œ ìˆ˜ ì—†ëŠ” í˜•ì‹
}
```

#### ì•ˆì „í•œ ì••ì¶• ë§ˆì´ê·¸ë ˆì´ì…˜

ì••ì¶• ì„¤ì • ë³€ê²½ ì‹œ ë°ì´í„° ì†ì‹¤ ì—†ì´ ì•ˆì „í•˜ê²Œ í˜•ì‹ì„ ë³€í™˜í•©ë‹ˆë‹¤:

**ì•ˆì „ ë©”ì»¤ë‹ˆì¦˜:**
1. **UI ì°¨ë‹¨**: ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì‚¬ìš©ì ì¡°ì‘ ë°©ì§€
2. **ì›ë³¸ ë³´ì¡´**: ì„ì‹œ í‚¤ì— ë¨¼ì € ì €ì¥ (ì›ë³¸ ìœ ì§€)
3. **ê²€ì¦**: ì„ì‹œ ë°ì´í„°ê°€ ì›ë³¸ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
4. **ë¡¤ë°±**: ì‹¤íŒ¨ ì‹œ ì„ì‹œ ë°ì´í„° ì‚­ì œ, ì›ë³¸ ë³µêµ¬
5. **ìš©ëŸ‰ í™•ì¸**: ì €ì¥ì†Œ ë¶€ì¡± ì‹œ JSON ìœ ì§€

```javascript
// storage.js - async í•¨ìˆ˜
async migrateCompression(enableCompression) {
    const TEMP_SUFFIX = '_migration_temp';

    for (const { main, backup } of keysToMigrate) {
        const originalRaw = localStorage.getItem(main);

        // 1. ì›ë³¸ ë°ì´í„° í•´ì œ
        const data = this.decompress(originalRaw);

        // 2. ìƒˆ í˜•ì‹ìœ¼ë¡œ ì§ë ¬í™”
        const newSerialized = enableCompression
            ? this.compress(data)
            : JSON.stringify(data);

        // 3. ì„ì‹œ í‚¤ì— ì €ì¥ (ì›ë³¸ ë³´ì¡´)
        const tempKey = main + TEMP_SUFFIX;
        try {
            localStorage.setItem(tempKey, newSerialized);
        } catch (quotaError) {
            // ìš©ëŸ‰ ë¶€ì¡± - ë¡¤ë°±
            return { success: false, message: 'ìš©ëŸ‰ ë¶€ì¡±' };
        }

        // 4. ì„ì‹œ ë°ì´í„° ê²€ì¦
        const verifyData = this.decompress(localStorage.getItem(tempKey));
        if (JSON.stringify(data) !== JSON.stringify(verifyData)) {
            // ê²€ì¦ ì‹¤íŒ¨ - ë¡¤ë°±
            localStorage.removeItem(tempKey);
            continue;
        }

        // 5. ê²€ì¦ ì„±ê³µ - ë©”ì¸ì— ì ìš©
        localStorage.setItem(main, newSerialized);
        localStorage.removeItem(tempKey);  // ì„ì‹œ ì‚­ì œ
    }

    return { success: true };
}
```

#### ì••ì¶• ê´€ë ¨ í•¨ìˆ˜

| í•¨ìˆ˜ | ì—­í•  |
|------|------|
| `compress(data)` | LZ-String UTF-16 ì••ì¶• (ì ‘ë‘ì‚¬ 'LZ:' ì¶”ê°€) |
| `decompress(raw)` | ìë™ í˜•ì‹ ê°ì§€ ë° í•´ì œ (JSON/LZ-String) |
| `saveCompressed(key, data)` | ì••ì¶• ì„¤ì •ì— ë”°ë¼ ì €ì¥ |
| `loadCompressed(key)` | ìë™ í˜•ì‹ ê°ì§€í•˜ì—¬ ë¡œë“œ |
| `migrateCompression(enable)` | **async** - ì•ˆì „í•œ ì••ì¶• í˜•ì‹ ë³€í™˜ |
| `getCompressionStats()` | ì••ì¶•ë¥  í†µê³„ ë°˜í™˜ (ì›ë³¸/ì••ì¶• í¬ê¸°, ë¹„ìœ¨) |
| `_showMigrationOverlay()` | ë§ˆì´ê·¸ë ˆì´ì…˜ UI ì°¨ë‹¨ ì˜¤ë²„ë ˆì´ í‘œì‹œ |
| `_hideMigrationOverlay()` | ë§ˆì´ê·¸ë ˆì´ì…˜ UI ì°¨ë‹¨ ì˜¤ë²„ë ˆì´ ì œê±° |
| `_cleanupMigrationTemp()` | ì„ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë°ì´í„° ì •ë¦¬ |

### ì €ì¥ì†Œ ìš©ëŸ‰ ê´€ë¦¬

localStorageì˜ ì œí•œëœ ìš©ëŸ‰(5MB)ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

#### ìš©ëŸ‰ êµ¬ì„± ë¶„ì„

| ë°ì´í„° ìœ í˜• | ë‹¨ì–´ë‹¹ í¬ê¸° | 10,000ë‹¨ì–´ ì‹œ | ì„¤ëª… |
|-------------|-------------|---------------|------|
| ë‹¨ì–´ ë°ì´í„° | ~500 bytes | ~5 MB | ë‹¨ì–´, ë°œìŒ, ëœ», ì˜ˆë¬¸ |
| í•™ìŠµ ìƒíƒœ | ~50 bytes | ~500 KB | ID + ìƒíƒœ |
| ë°±ì—… ë°ì´í„° | ë™ì¼ | ~5.5 MB | ë©”ì¸ + ë°±ì—… ì´ì¤‘ ì €ì¥ |
| **ë¹„ìœ¨** | | | ë‹¨ì–´ : í•™ìŠµ ìƒíƒœ â‰ˆ **10 : 1** |

#### ìš©ëŸ‰ ì œí•œ ì •ì±…

- **85% í•œê³„**: ì €ì¥ì†Œ 85% ì´ˆê³¼ ì‹œ ìƒˆ ë‹¨ì–´ ì¶”ê°€ ì°¨ë‹¨
- **10% ì‹œìŠ¤í…œ ì—¬ìœ **: ë¸Œë¼ìš°ì € ì˜¤ë²„í—¤ë“œ, ì„ì‹œ ë°ì´í„°
- **5% í•™ìŠµ ìƒíƒœ ì—¬ìœ **: ë‹¨ì–´ ì¶”ê°€ ì—†ì´ë„ ìƒíƒœ ë³€ê²½ë¨

```javascript
// storage.js
canAddWord(estimatedNewDataSize = 1024) {
    const stats = this.getStorageStats();
    const THRESHOLD_PERCENT = 85;

    if (stats.percentUsed >= THRESHOLD_PERCENT) {
        return {
            canAdd: false,
            currentPercent: stats.percentUsed,
            message: 'ì €ì¥ì†Œ ìš©ëŸ‰ì´ í•œê³„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.'
        };
    }
    return { canAdd: true, currentPercent: stats.percentUsed };
}

canImportData(jsonDataSize) {
    // jsonDataSize: ì••ì¶• í•´ì œëœ JSON ë¬¸ìì—´ì˜ ê¸¸ì´ (ë¬¸ì ìˆ˜)
    const compressionRatio = this.settings.compression?.enabled ? 0.4 : 1;
    const estimatedTotalNew = jsonDataSize * 2 * compressionRatio;
    const estimatedPercent = ((stats.totalUsed + estimatedTotalNew) / stats.total) * 100;

    if (estimatedPercent >= 85) {
        return {
            canImport: false,
            message: `ì €ì¥ì†Œê°€ ${estimatedPercent}%ê°€ ë©ë‹ˆë‹¤. ìš©ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.`
        };
    }
    return { canImport: true, estimatedPercent };
}

canImportWords(wordCount, avgSizePerWord = 500) {
    // ì˜ˆìƒ í¬ê¸°: (ë‹¨ì–´ ë°ì´í„° + ì§„í–‰ ìƒíƒœ) * 2 (ë°±ì—… í¬í•¨)
    const compressionRatio = this.settings.compression?.enabled ? 0.4 : 1;
    const estimatedTotalNew = (wordCount * avgSizePerWord + wordCount * 50) * 2 * compressionRatio;
    const estimatedPercent = ((stats.totalUsed + estimatedTotalNew) / stats.total) * 100;

    if (estimatedPercent >= 85) {
        return {
            canImport: false,
            maxImportable: Math.floor((stats.total * 0.85 - stats.totalUsed) / (avgSizePerWord * compressionRatio * 2 + 100)),
            message: `ìµœëŒ€ ${maxImportable}ê°œê¹Œì§€ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`
        };
    }
    return { canImport: true, estimatedPercent };
}
```

#### ìš©ëŸ‰ ê´€ë ¨ í•¨ìˆ˜

| í•¨ìˆ˜ | ì—­í•  |
|------|------|
| `getStorageUsage()` | í˜„ì¬ ì‚¬ìš©ëŸ‰ / ì „ì²´ ìš©ëŸ‰ / í¼ì„¼íŠ¸ ë°˜í™˜ |
| `getStorageStats()` | ìƒì„¸ í†µê³„: ë‹¨ì–´/ì§„í–‰/ë°±ì—… ë³„ ìš©ëŸ‰, ë‹¨ì–´ë‹¹ í‰ê·  í¬ê¸° |
| `canAddWord(size)` | ë‹¨ì–´ ì¶”ê°€ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ (85% í•œê³„) |
| `canImportData(jsonSize)` | íŒŒì¼ ê°€ì ¸ì˜¤ê¸° ì „ ìš©ëŸ‰ í™•ì¸ (ì••ì¶• í•´ì œëœ JSON í¬ê¸° ê¸°ì¤€) |
| `canImportWords(count, avgSize)` | ëŒ€ëŸ‰ ê°€ì ¸ì˜¤ê¸° ì „ ìš©ëŸ‰ í™•ì¸ (ë‹¨ì–´ ìˆ˜ ê¸°ì¤€) |
| `canDisableCompression()` | ì••ì¶• í•´ì œ ì‹œ 90% ì´ˆê³¼ ì—¬ë¶€ í™•ì¸ |

### ì„¤ì • ì´ˆê¸°í™”

ì‚¬ìš©ì ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤:

```javascript
// storage.js
resetSettings() {
    const defaultSettings = {
        darkMode: false,
        showPronunciation: true,
        displayMode: 'paging',
        itemsPerPage: 20,
        backupReminder: { enabled: true, frequency: 7 },
        debugMode: { enabled: false, showTestPage: false, showArchitecturePage: false },
        compression: { enabled: false },
        ui: { /* ê¸°ë³¸ UI ì„¤ì • */ }
    };

    this.settings = defaultSettings;
    localStorage.setItem(KEYS.SETTINGS, JSON.stringify(this.settings));
}
```

**ì´ˆê¸°í™” ëŒ€ìƒ**: ë‹¤í¬ëª¨ë“œ, ë°œìŒí‘œì‹œ, ë°±ì—…ì•Œë¦¼, ë””ë²„ê·¸ëª¨ë“œ, ì••ì¶•ì„¤ì •, UIì„¤ì •
**ìœ ì§€ í•­ëª©**: í•™ìŠµ ì§„ë„(progress), í†µê³„(stats), ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬(customCategories)

### ê´€ë ¨ íŒŒì¼

- **test.html**: ê°œë°œì í…ŒìŠ¤íŠ¸ í˜ì´ì§€
  - localStorage ë°ì´í„° ì¡°íšŒ
  - ì˜ë„ì  ë°ì´í„° ì†ìƒ í…ŒìŠ¤íŠ¸
  - ë³µêµ¬ ì‹œë®¬ë ˆì´ì…˜
  - Write-Verify íŒ¨í„´ í…ŒìŠ¤íŠ¸

- **architecture.html**: ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì„œ
  - Mermaid ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ êµ¬ì¡° ì‹œê°í™”
  - Write-Verify íë¦„ë„
  - ë³µêµ¬ ìš°ì„ ìˆœìœ„ ë‹¤ì´ì–´ê·¸ë¨
  - ë©€í‹°íƒ­ ë™ê¸°í™” íë¦„ë„

---

## ë°ì´í„° íë¦„

### ì•± ì´ˆê¸°í™” ìˆœì„œ

```javascript
// data.js - DOMContentLoaded ì´ë²¤íŠ¸
document.addEventListener('DOMContentLoaded', () => {
    VocabData.tts.init();          // 1. TTS ì´ˆê¸°í™”

    if (Storage.init) {
        Storage.init();             // 2. Storage ì´ˆê¸°í™” (localStorage ë¡œë“œ)
    }

    VocabData.loadAll().then(() => {
        VocabData.loadCustomCategories();  // 3. ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬ ë¡œë“œ

        if (typeof initApp === 'function') {
            initApp();              // 4. ì•± UI ì´ˆê¸°í™”
        }
    });
});
```

### í•™ìŠµ ìƒíƒœ ë³€ê²½ íë¦„

```
ì‚¬ìš©ì ì•¡ì…˜ (ì•”ê¸°ì™„ë£Œ ë²„íŠ¼ í´ë¦­)
        â”‚
        â–¼
updateWordStatus(wordId, 'memorized')  [app.js]
        â”‚
        â–¼
Storage.setWordStatus(wordId, status)   [storage.js]
        â”‚
        â”œâ”€ this.progress[wordId] = status  (ë©”ëª¨ë¦¬ ì—…ë°ì´íŠ¸)
        â”‚
        â””â”€ this.saveProgress()             (ì €ì¥)
                â”‚
                â”œâ”€ initialized ì²´í¬
                â”œâ”€ _loadStatus ì²´í¬
                â”‚
                â”œâ”€ [ì •ìƒ] localStorage.setItem()
                â””â”€ [corrupted] sessionStorage.setItem()
```

### ë°±ì—…/ë³µì› íë¦„

```
[ë‚´ë³´ë‚´ê¸°]
exportData()
  â”‚
  â”œâ”€ ì••ì¶• ëª¨ë“œ ON â†’ .lzstr íŒŒì¼ ë‹¤ìš´ë¡œë“œ (LZ-String ì••ì¶•)
  â””â”€ ì••ì¶• ëª¨ë“œ OFF â†’ .json íŒŒì¼ ë‹¤ìš´ë¡œë“œ
  â”‚
  â””â”€ í¬í•¨ ë°ì´í„°:
      - progress (í•™ìŠµ ì§„ë„)
      - settings (ì„¤ì •)
      - stats (í†µê³„)
      - customCategories (ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬)
      - disabledCategories (ë¹„í™œì„± ì¹´í…Œê³ ë¦¬)

[ê°€ì ¸ì˜¤ê¸°]
íŒŒì¼ ì„ íƒ (.json ë˜ëŠ” .lzstr)
  â”‚
  â”œâ”€ .lzstr â†’ LZString.decompressFromUTF16()
  â””â”€ .json â†’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
  â”‚
  â””â”€ handleImport()
       â”‚
       â”œâ”€ íŒŒì¼ ì½ê¸° ë° ì••ì¶• í•´ì œ (í•„ìš”ì‹œ)
       â”œâ”€ canImportData(jsonData.length) ìš©ëŸ‰ ì²´í¬
       â”‚    â”œâ”€ ì••ì¶• ëª¨ë“œ ON: JSONí¬ê¸° Ã— 2 Ã— 0.4
       â”‚    â””â”€ ì••ì¶• ëª¨ë“œ OFF: JSONí¬ê¸° Ã— 2
       â”‚
       â””â”€ Storage.importData()
            â”‚
            â”œâ”€ Version ê²€ì‚¬ ë° ë§ˆì´ê·¸ë ˆì´ì…˜
            â”œâ”€ ê° ë°ì´í„° íƒ€ì… ë¨¸ì§€
            â”œâ”€ _loadStatus = 'loaded' (ì •ìƒí™”)
            â””â”€ ì €ì¥

            â–¼
      VocabData.reloadCustomCategories()
      renderCategories()

[ìš©ëŸ‰ ì²´í¬ í•µì‹¬]
- íŒŒì¼ì„ ë¨¼ì € ì½ê³  ì••ì¶• í•´ì œ í›„ JSON í¬ê¸°ë¡œ ìš©ëŸ‰ ê³„ì‚°
- .lzstr íŒŒì¼ë„ ì••ì¶• í•´ì œëœ JSON í¬ê¸° ê¸°ì¤€ìœ¼ë¡œ ì²´í¬
- ì••ì¶• ëª¨ë“œ í™œì„±í™” ì‹œ 40% ì••ì¶•ë¥  ì ìš©
```

---

## ë²„ì „ ê´€ë¦¬ ë° ë§ˆì´ê·¸ë ˆì´ì…˜

### ë²„ì „ ì²´ê³„

```
MAJOR.MINOR.PATCH (ì˜ˆ: 1.0.0)

MAJOR: í•˜ìœ„ í˜¸í™˜ì„± ì—†ëŠ” ë³€ê²½ (ë°ì´í„° êµ¬ì¡° ë³€ê²½)
MINOR: í•˜ìœ„ í˜¸í™˜ ê¸°ëŠ¥ ì¶”ê°€
PATCH: ë²„ê·¸ ìˆ˜ì •
```

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì½”ë“œ

```javascript
// version.js
migrate(data, fromVersion) {
    let migratedData = { ...data };
    const normalizedFrom = this.normalize(fromVersion);

    // 0.x.x â†’ 1.0.0 ë§ˆì´ê·¸ë ˆì´ì…˜
    if (this.compare(normalizedFrom, '1.0.0') < 0) {
        migratedData = this.migrateToV1(migratedData);
    }

    // í–¥í›„ ë²„ì „ ì¶”ê°€ ì‹œ:
    // if (this.compare(normalizedFrom, '2.0.0') < 0) {
    //     migratedData = this.migrateToV2(migratedData);
    // }

    migratedData.version = this.CURRENT;
    return migratedData;
}

// 0.x.x â†’ 1.0.0: meaning â†’ meanings ë°°ì—´ ë³€í™˜
migrateToV1(data) {
    if (data.customCategories) {
        data.customCategories = data.customCategories.map(cat => {
            if (cat.words) {
                cat.words = cat.words.map(word => {
                    if (word.meaning && !word.meanings) {
                        word.meanings = [{
                            meaning: word.meaning,
                            partOfSpeech: word.partOfSpeech || '',
                            examples: word.examples || []
                        }];
                    }
                    return word;
                });
            }
            return cat;
        });
    }
    return data;
}
```

---

## UI ì»´í¬ë„ŒíŠ¸

### í™”ë©´ êµ¬ì¡°

```html
<div class="view" id="home-view">     <!-- í™ˆ (ì¹´í…Œê³ ë¦¬ ì„ íƒ) -->
<div class="view" id="list-view">     <!-- ë‹¨ì–´ ëª©ë¡ -->
<div class="view" id="flashcard-view"> <!-- í”Œë˜ì‹œì¹´ë“œ -->
<div class="view" id="blink-view">    <!-- ë¸”ë§í¬ ëª¨ë“œ -->
<div class="view" id="quiz-view">     <!-- í€´ì¦ˆ -->
<div class="view" id="settings-view"> <!-- ì„¤ì • -->
```

### CSS Variables (ë‹¤í¬ëª¨ë“œ)

```css
:root {
    --bg-primary: #f8f9fa;
    --bg-secondary: #ffffff;
    --text-primary: #1f2937;
    --accent-color: #3b82f6;
    /* ... */
}

[data-theme="dark"] {
    --bg-primary: #111827;
    --bg-secondary: #1f2937;
    --text-primary: #f9fafb;
    /* ... */
}
```

### ëª¨ë‹¬ íŒ¨í„´

```html
<div class="modal hidden" id="add-word-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ì œëª©</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <!-- ë‚´ìš© -->
        </div>
        <div class="modal-footer">
            <!-- ë²„íŠ¼ -->
        </div>
    </div>
</div>
```

---

## PWA ê´€ë ¨

### Service Worker êµ¬ì¡°

```javascript
// sw.js ì£¼ìš” êµ¬ì„±
const SW_VERSION = '5.1.0';           // ì„œë¹„ìŠ¤ ì›Œì»¤ ë²„ì „
const STATIC_CACHE = 'vocabmaster-static-v5';  // ì •ì  íŒŒì¼ ìºì‹œ
const DATA_CACHE = 'vocabmaster-data-v5';      // ë°ì´í„° íŒŒì¼ ìºì‹œ
```

### ìºì‹œ ì „ëµ

| ë¦¬ì†ŒìŠ¤ íƒ€ì… | ì „ëµ | ì„¤ëª… |
|------------|------|------|
| ì •ì  íŒŒì¼ (HTML, CSS, JS) | Cache-First | ìºì‹œ ìš°ì„ , ì—†ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ |
| ë°ì´í„° íŒŒì¼ (JSON) | Cache-First | ìºì‹œ ìš°ì„ , ì—†ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ |
| í°íŠ¸ (Google Fonts) | Cache-First | ìºì‹œ ìš°ì„  |
| ë„¤ë¹„ê²Œì´ì…˜ ì‹¤íŒ¨ | Offline Fallback | index.html ë°˜í™˜ |

### Service Worker ë¼ì´í”„ì‚¬ì´í´

```
ì„¤ì¹˜(Install) â†’ í™œì„±í™”(Activate) â†’ ëŒ€ê¸°(Idle) â†’ Fetch ì²˜ë¦¬
     â†“                â†“
 íŒŒì¼ ìºì‹±      ì´ì „ ìºì‹œ ì •ë¦¬
```

### ì„œë¹„ìŠ¤ ì›Œì»¤ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬

```javascript
// 1. Install - íŒŒì¼ ìºì‹±
self.addEventListener('install', (event) => {
    event.waitUntil(
        caches.open(STATIC_CACHE).then(cache => cache.addAll(STATIC_FILES))
    );
});

// 2. Activate - ì´ì „ ìºì‹œ ì •ë¦¬
self.addEventListener('activate', (event) => {
    event.waitUntil(
        caches.keys().then(names => {
            return Promise.all(
                names.filter(n => n !== STATIC_CACHE && n !== DATA_CACHE)
                     .map(n => caches.delete(n))
            );
        })
    );
});

// 3. Fetch - ìºì‹œ ìš°ì„  ì‘ë‹µ
self.addEventListener('fetch', (event) => {
    event.respondWith(
        caches.match(event.request).then(cached => {
            return cached || fetch(event.request);
        })
    );
});

// 4. Message - ë©”ì¸ ìŠ¤ë ˆë“œ í†µì‹ 
self.addEventListener('message', (event) => {
    if (event.data.type === 'SKIP_WAITING') self.skipWaiting();
    if (event.data.type === 'GET_VERSION') { /* ë²„ì „ ë°˜í™˜ */ }
    if (event.data.type === 'CLEAR_CACHE') { /* ìºì‹œ ì „ì²´ ì‚­ì œ */ }
    if (event.data.type === 'GET_CACHE_SIZE') { /* ìºì‹œ í¬ê¸° ë°˜í™˜ */ }
});

// 5. Push - í‘¸ì‹œ ì•Œë¦¼ (í–¥í›„ í™•ì¥ìš©)
self.addEventListener('push', (event) => { /* ì•Œë¦¼ í‘œì‹œ */ });

// 6. Sync - ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” (í–¥í›„ í™•ì¥ìš©)
self.addEventListener('sync', (event) => { /* ë™ê¸°í™” ì²˜ë¦¬ */ });
```

### ì—…ë°ì´íŠ¸ ê°ì§€ ë° ì²˜ë¦¬

```javascript
// index.html - ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ë° ì—…ë°ì´íŠ¸ ì²˜ë¦¬
navigator.serviceWorker.register('./sw.js').then(registration => {
    // 1ì‹œê°„ë§ˆë‹¤ ì—…ë°ì´íŠ¸ í™•ì¸
    setInterval(() => registration.update(), 60 * 60 * 1000);

    // ì—…ë°ì´íŠ¸ ê°ì§€
    registration.addEventListener('updatefound', () => {
        const newWorker = registration.installing;
        newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // ìƒˆ ë²„ì „ ë°œê²¬ â†’ í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
                showUpdateNotification();
            }
        });
    });
});

// ìƒˆ ì„œë¹„ìŠ¤ ì›Œì»¤ í™œì„±í™” ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨
navigator.serviceWorker.addEventListener('controllerchange', () => {
    window.location.reload();
});
```

### PWA ë’¤ë¡œê°€ê¸° ì²˜ë¦¬

```javascript
// app.js - ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í•¸ë“¤ëŸ¬
function initPWABackHandler() {
    window.history.pushState({ page: 'app' }, '', '');
    window.addEventListener('popstate', handleBackButton);
}

function handleBackButton(e) {
    window.history.pushState({ page: 'app' }, '', '');  // ìƒíƒœ ìœ ì§€

    // 1. ëª¨ë‹¬ ì—´ë¦¼ â†’ ëª¨ë‹¬ ë‹«ê¸°
    if (openModals.length > 0) { closeTopModal(); return; }

    // 2. ë¸”ë§í¬/í€´ì¦ˆ ì§„í–‰ ì¤‘ â†’ í•´ë‹¹ ëª¨ë“œ ì¢…ë£Œ
    if (isBlinkRunning) { stopBlink(); return; }
    if (isQuizRunning) { endQuiz(); return; }

    // 3. í™ˆì´ ì•„ë‹Œ í™”ë©´ â†’ í™ˆìœ¼ë¡œ ì´ë™
    if (currentView !== 'home-view') { showHome(); return; }

    // 4. í™ˆì—ì„œ ë’¤ë¡œê°€ê¸° â†’ 2íšŒ ëˆ„ë¥´ë©´ ì¢…ë£Œ
    if (backPressedOnce) {
        window.removeEventListener('popstate', handleBackButton);
        window.history.back();  // ì‹¤ì œ ì¢…ë£Œ
    } else {
        backPressedOnce = true;
        showToast('í•œë²ˆ ë” ëˆ„ë¥´ë©´ ì•±ì´ ì¢…ë£Œë©ë‹ˆë‹¤');
        setTimeout(() => backPressedOnce = false, 2000);
    }
}
```

### PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì„¤ì •

```json
// manifest.json
{
    "name": "VocabMaster - ì˜ì–´ ë‹¨ì–´ ì•”ê¸°",
    "short_name": "VocabMaster",
    "start_url": "./",
    "display": "standalone",      // ì „ì²´ í™”ë©´ ëª¨ë“œ
    "orientation": "portrait",    // ì„¸ë¡œ ëª¨ë“œ ê³ ì •
    "theme_color": "#4F46E5",     // í…Œë§ˆ ìƒ‰ìƒ
    "background_color": "#ffffff",
    "icons": [
        { "src": "./icons/icon-192x192.png", "sizes": "192x192", "type": "image/png" },
        { "src": "./icons/icon-512x512.png", "sizes": "512x512", "type": "image/png" }
    ]
}
```

### ì„œë¹„ìŠ¤ ì›Œì»¤ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

```javascript
// ìºì‹œ ì „ì²´ ì‚­ì œ (ë””ë²„ê¹…ìš©)
async function clearAllCaches() {
    const names = await caches.keys();
    await Promise.all(names.map(n => caches.delete(n)));
}

// ìºì‹œ í¬ê¸° ì¡°íšŒ
async function getCacheSize() {
    let totalSize = 0;
    const names = await caches.keys();
    for (const name of names) {
        const cache = await caches.open(name);
        const keys = await cache.keys();
        for (const req of keys) {
            const res = await cache.match(req);
            const blob = await res.clone().blob();
            totalSize += blob.size;
        }
    }
    return totalSize;  // bytes
}

// ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŠ¸
async function broadcastMessage(message) {
    const clients = await self.clients.matchAll({ includeUncontrolled: true });
    clients.forEach(client => client.postMessage(message));
}
```

### ì„œë¹„ìŠ¤ ì›Œì»¤ ë²„ì „ ì—…ë°ì´íŠ¸ ì ˆì°¨

1. `sw.js`ì—ì„œ ìºì‹œ ë²„ì „ ì¦ê°€ (ì˜ˆ: v5 â†’ v6)
2. í•„ìš”ì‹œ `SW_VERSION` ìƒìˆ˜ ì—…ë°ì´íŠ¸
3. ë°°í¬ í›„ ì‚¬ìš©ìê°€ ì•± ì ‘ì† ì‹œ:
   - ë¸Œë¼ìš°ì €ê°€ ìƒˆ ì„œë¹„ìŠ¤ ì›Œì»¤ ê°ì§€
   - ìƒˆ ë²„ì „ ì„¤ì¹˜ ë° ëŒ€ê¸°
   - í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
   - ì‚¬ìš©ìê°€ "ì—…ë°ì´íŠ¸" í´ë¦­ ì‹œ í™œì„±í™”
   - í˜ì´ì§€ ìë™ ìƒˆë¡œê³ ì¹¨

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ë°ì´í„°ê°€ ê°‘ìê¸° ì´ˆê¸°í™”ë¨

**ì›ì¸ ë¶„ì„**:
- init() ì „ save í˜¸ì¶œ
- ë¡œë“œ ì‹¤íŒ¨ í›„ ë¹ˆ ë°ì´í„° ì €ì¥
- localStorage quota ì´ˆê³¼

**í•´ê²°**:
- Consoleì—ì„œ `[Storage]` ë¡œê·¸ í™•ì¸
- `Storage._loadStatus` ê°’ í™•ì¸
- ë°±ì—… íŒŒì¼ì—ì„œ ë³µêµ¬

### 2. ì‚¬ìš©ì ì¹´í…Œê³ ë¦¬ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

**ì›ì¸**: `VocabData.reloadCustomCategories()` ë¯¸í˜¸ì¶œ

**í•´ê²°**:
```javascript
// ì¹´í…Œê³ ë¦¬ ë³€ê²½ í›„ ë°˜ë“œì‹œ í˜¸ì¶œ
VocabData.reloadCustomCategories();
renderCategories();
```

### 3. TTSê°€ ë™ì‘í•˜ì§€ ì•ŠìŒ

**ì›ì¸**: ë¸Œë¼ìš°ì € TTS ì •ì±… (ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í•„ìš”)

**í•´ê²°**:
```javascript
// ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ì—ì„œ í˜¸ì¶œ
button.addEventListener('click', () => {
    VocabData.speak(word);
});
```

---

## í™•ì¥ ê°€ì´ë“œ

### ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€

1. `data/` í´ë”ì— JSON íŒŒì¼ ìƒì„±
2. `scripts/bundleData.js`ì— íŒŒì¼ ì¶”ê°€
3. `sw.js` DATA_FILESì— ì¶”ê°€
4. ë²ˆë“¤ ì¬ìƒì„±: `node scripts/bundleData.js`

### ìƒˆ í•™ìŠµ ëª¨ë“œ ì¶”ê°€

1. `index.html`ì— ë·° ì¶”ê°€
2. `app.js`ì— í•¨ìˆ˜ ì¶”ê°€
3. `style.css`ì— ìŠ¤íƒ€ì¼ ì¶”ê°€
4. Navigation ì—°ê²°

### ìƒˆ ì„¤ì • í•­ëª© ì¶”ê°€

1. `storage.js`ì˜ `settings` ê°ì²´ì— ê¸°ë³¸ê°’ ì¶”ê°€
2. `index.html`ì— ì„¤ì • UI ì¶”ê°€
3. `app.js`ì— ì„¤ì • ë¡œë“œ/ì €ì¥ í•¨ìˆ˜ ì¶”ê°€

---

## ì½”ë”© ì»¨ë²¤ì…˜

### JavaScript

```javascript
// í•¨ìˆ˜: camelCase
function loadProgress() { }

// ìƒìˆ˜: UPPER_SNAKE_CASE
const KEYS = { PROGRESS: 'vocabmaster_progress' };

// ë¹„ê³µê°œ ë©¤ë²„: _ ì ‘ë‘ì‚¬
_loadStatus: { }
_mergeProgress(current, temp) { }
```

### CSS

```css
/* BEM-like ë„¤ì´ë° */
.category-card { }
.category-card__icon { }
.category-card--disabled { }
```

---

## ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

1. **ë°ì´í„° ë²ˆë“¤ë§**: ê°œë³„ JSON ë¡œë“œ ëŒ€ì‹  ë‹¨ì¼ ë²ˆë“¤ ì‚¬ìš©
2. **ì§€ì—° ë¡œë”©**: í•„ìš” ì‹œì ì— ë°ì´í„° ë¡œë“œ
3. **DOM ìµœì†Œí™”**: ê°€ìƒ ìŠ¤í¬ë¡¤, í˜ì´ì§• ì ìš©
4. **ì´ë²¤íŠ¸ ìœ„ì„**: ê°œë³„ ìš”ì†Œ ëŒ€ì‹  ë¶€ëª¨ì— ì´ë²¤íŠ¸ ë°”ì¸ë”©

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **XSS ë°©ì§€**: innerHTML ì‚¬ìš© ì‹œ ì‚¬ìš©ì ì…ë ¥ ì´ìŠ¤ì¼€ì´í”„
2. **localStorage ë¯¼ê° ì •ë³´ ì €ì¥ ê¸ˆì§€**: ê°œì¸ì •ë³´ ì €ì¥í•˜ì§€ ì•ŠìŒ
3. **ì™¸ë¶€ API í˜¸ì¶œ ì œí•œ**: ì˜ì˜ì‚¬ì „ APIë§Œ ì‚¬ìš©

---

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-12-22*
