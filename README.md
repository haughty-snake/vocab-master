# VocabMaster - 영어 단어 암기 PWA

효과적인 영어 단어 암기를 위한 종합 학습 Progressive Web App (PWA)입니다.

## 바로 사용하기

**[https://haughty-snake.github.io/vocab-master](https://haughty-snake.github.io/vocab-master)**

위 링크를 클릭하여 바로 학습을 시작하세요. 모바일에서는 "홈 화면에 추가"로 앱처럼 설치할 수 있습니다.

## PWA 기능

VocabMaster는 PWA(Progressive Web App)로 제작되어 다음과 같은 기능을 제공합니다:

### 앱 설치
- **모바일**: 브라우저 메뉴에서 "홈 화면에 추가"를 선택하여 앱처럼 설치
- **데스크톱**: 주소창의 설치 버튼을 클릭하여 독립 앱으로 설치
- 설치 후 네이티브 앱처럼 전체 화면으로 실행 가능

### 오프라인 지원
- Service Worker를 통한 오프라인 캐싱
- 인터넷 연결 없이도 학습 가능
- 학습 데이터는 로컬에 자동 저장

### 자동 업데이트
- 새 버전 출시 시 자동 감지
- 업데이트 알림 및 즉시 적용

## 주요 기능

### 1. 카테고리별 학습

- **명사** (546개): 일상 대화 필수 명사
- **동사** (600개): 기본 동작부터 고급 표현까지
- **형용사** (550개): 감정, 상태, 특성 표현
- **부사** (319개): 시간, 빈도, 정도 표현
- **전치사/접속사** (212개): 문장 연결 표현
- **숙어/관용표현** (632개): 자연스러운 표현
- **구동사** (74개): 필수 구동사
- **필수 단어** (132개): 빈출 어휘
- **문장 패턴** (300개): 기초~고급 패턴
- **추가 표현** (195개): 연결어, 감정 표현 등
- **중급 단어** (358개): 중급 어휘
- **고급 단어** (310개): 고급 어휘
- **추가 숙어** (260개): 실용적인 숙어 표현
- **추가 구동사** (160개): 고급 구동사

**총 4,500+ 단어 및 표현**

### 2. 사용자 정의 카테고리

- **나만의 카테고리 생성**: 원하는 단어장을 직접 만들기
- **단어 추가/수정/삭제**: 카테고리 내 단어 관리
- **다의어 지원**: 하나의 단어에 여러 뜻 등록 (`[품사]뜻` 형태로 표시)
- **카테고리명 수정**: 카테고리 이름 변경 가능
- **파일 가져오기**: JSON/텍스트 파일로 단어 일괄 추가
- **카테고리 공유**:
  - 선택한 카테고리를 JSON 파일로 내보내기
  - 다른 사람이 만든 카테고리 가져오기
  - 동일한 이름의 카테고리는 자동 건너뛰기

### 3. 학습 모드

#### 플래시카드 모드
- 카드 뒤집기로 단어/뜻 학습
- 암기 완료/학습 중 표시
- 카드 섞기 기능
- 키보드 단축키 지원 (스페이스바: 뒤집기, 화살표: 이동)
- **TTS 음성 읽기** (단어/예문 버튼 클릭)
- **TTS 자동/수동 설정**: 카드 넘길 때 자동 읽기 옵션

#### 블링크 모드
- 빠른 속도로 단어 노출 (0.5초~3초)
- 순간 기억력 훈련
- 영어만/뜻만/둘 다 표시 옵션
- 반복 횟수 설정 (1~5회)
- **TTS 자동 읽기 옵션**

#### 퀴즈 모드
- 4지선다 문제
- 뜻 맞추기/단어 맞추기/혼합 모드
- 10/20/50/100 문제 선택
- 결과 통계 및 오답 학습
- 다의어 단어는 `[품사]뜻` 형태로 표시

### 4. TTS (Text-to-Speech) 음성 읽기
- Web Speech API 활용 (브라우저 내장, 무료)
- 플래시카드/블링크에서 단어/예문 음성 읽기
- TTS 버튼 클릭 시 항상 재생

### 5. 진행률 관리
- 단어별 암기 상태 추적 (새 단어/학습 중/암기 완료)
- 카테고리별 진행률 표시
- 전체 학습 통계

### 6. 데이터 관리
- **localStorage 저장**: 브라우저에 학습 기록 자동 저장
- **내보내기**: JSON 파일로 학습 데이터 백업
- **가져오기**: 백업 파일로 데이터 복원 (병합 모드)
- **초기화**: 학습 기록 완전 삭제
- **백업 알림**: 마지막 백업 후 일정 기간 경과 시 알림
- **버전 관리**: 시멘틱 버저닝으로 데이터 호환성 보장

### 7. 카테고리 공유
- **사용자 정의 카테고리 내보내기**: 선택한 카테고리만 JSON 파일로 저장
- **카테고리 가져오기**: 다른 사람이 공유한 카테고리 파일 불러오기
- **중복 체크**: 동일한 이름의 카테고리는 자동 건너뛰기

### 8. 설정
- 다크 모드 지원
- 발음 기호 표시 on/off
- 플래시카드 애니메이션 on/off
- 앱 버전 표시

## 버전 관리 시스템

VocabMaster는 **시멘틱 버저닝(Semantic Versioning)**을 사용하여 데이터 호환성을 관리합니다.

### 버전 형식
```
MAJOR.MINOR.PATCH (예: 1.0.0)
```

| 구분 | 설명 | 호환성 |
|------|------|--------|
| MAJOR | 하위 호환성이 없는 큰 변경 | 마이그레이션 필요 |
| MINOR | 하위 호환성이 있는 기능 추가 | 호환 가능 |
| PATCH | 버그 수정 | 호환 가능 |

### Export 데이터 형식
```json
{
  "type": "vocabmaster_backup",
  "version": "1.0.0",
  "exportDate": "2024-12-21T12:00:00.000Z",
  "progress": { ... },
  "settings": { ... },
  "stats": { ... },
  "customCategories": [ ... ],
  "disabledCategories": [ ... ]
}
```

### 버전 호환성
- **하위 버전 → 상위 버전**: 자동 마이그레이션 지원
- **상위 버전 → 하위 버전**: 호환되지 않을 수 있음 (경고 표시)

### 버전 히스토리

| 버전 | 날짜 | 주요 변경사항 |
|------|------|--------------|
| 1.0.0 | 2024-12-21 | 시멘틱 버저닝 도입, 다의어 지원, 사용자 카테고리, 영영사전 조회 |

### 데이터 마이그레이션
이전 버전에서 내보낸 데이터를 가져올 때 자동으로 현재 버전 형식으로 변환됩니다:
- 구형 `meaning` 필드 → 신형 `meanings` 배열로 변환
- 누락된 필드 자동 보완

## 사용 방법

### GitHub Pages로 배포
1. 이 저장소를 Fork 하거나 Clone 합니다.
2. GitHub 저장소 Settings > Pages로 이동합니다.
3. Source를 "Deploy from a branch"로 설정합니다.
4. Branch를 "main"으로, 폴더를 "/vocab-master"로 설정합니다.
5. Save를 클릭하면 몇 분 후 웹사이트가 배포됩니다.

### 로컬에서 실행
```bash
# 저장소 클론
git clone https://github.com/your-username/opic-study-claude.git
cd opic-study-claude/vocab-master

# 로컬 서버 실행 (Python 3)
python -m http.server 8000

# 또는 Node.js
npx serve .
```
브라우저에서 `http://localhost:8000` 접속

## 파일 구조

```
vocab-master/
├── index.html          # 메인 HTML
├── manual.html         # 사용 매뉴얼
├── test.html           # 데이터 손상 테스트 페이지 (개발자용)
├── architecture.html   # 시스템 아키텍처 문서 (Mermaid 다이어그램)
├── manifest.json       # PWA 매니페스트
├── sw.js               # Service Worker
├── README.md           # 이 문서
├── css/
│   └── style.css       # 스타일시트
├── js/
│   ├── app.js          # 메인 앱 로직
│   ├── data.js         # 데이터 로딩/처리
│   ├── data.bundle.js  # 번들된 JSON 데이터
│   ├── storage.js      # localStorage 관리 (Write-Verify, 백업, 복구)
│   └── version.js      # 버전 관리
├── icons/              # PWA 아이콘
├── data/               # JSON 데이터 파일 (통합 포맷)
│   ├── nouns.json, verbs.json, adjectives.json, ...
│   └── (14개 카테고리 파일)
└── scripts/
    ├── convertToUnifiedFormat.js # 데이터 포맷 변환 스크립트
    └── generateIconsCanvas.js    # PWA 아이콘 생성 스크립트
```

## JSON 데이터 형식 (통합 포맷)

모든 데이터 파일은 사용자 정의 카테고리와 동일한 통합 포맷을 사용합니다:

```json
{
  "id": "nouns",
  "name": "명사",
  "icon": "📦",
  "color": "#4285f4",
  "words": [
    {
      "id": "nouns_person_0",
      "word": "person",
      "pronunciation": "/ˈpɜːrsn/",
      "subcategory": "사람",
      "meanings": [
        {
          "partOfSpeech": "",
          "meaning": "사람",
          "examples": [
            {
              "sentence": "She's a very kind person.",
              "translation": "그녀는 매우 친절한 사람이야."
            }
          ]
        }
      ],
      "pastTense": "",
      "pastParticiple": ""
    }
  ]
}
```

### 데이터 재생성
JSON 파일 수정 후 번들을 재생성하려면:
```bash
cd vocab-master
node scripts/convertToUnifiedFormat.js
```

## 키보드 단축키 (플래시카드 모드)

| 키 | 동작 |
|---|---|
| `Space` / `Enter` | 카드 뒤집기 |
| `←` | 이전 카드 |
| `→` | 다음 카드 |
| `1` | 암기 완료 표시 |
| `2` | 학습 중 표시 |

## 기술 스택

- **HTML5**: 시맨틱 마크업
- **CSS3**: CSS Variables, Flexbox, Grid, 애니메이션
- **JavaScript (ES6+)**: Vanilla JS, async/await, localStorage API
- **PWA**: Service Worker, Web App Manifest
- **Web Speech API**: TTS 음성 읽기
- **반응형 디자인**: 모바일/태블릿/데스크톱 지원

## 아키텍처

### 시스템 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                         사용자 인터페이스                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐            │
│  │플래시카드│ │ 블링크   │ │  퀴즈   │ │ 단어목록 │            │
│  └────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘            │
└───────┼────────────┼────────────┼────────────┼──────────────────┘
        │            │            │            │
        └────────────┴────────────┴────────────┘
                           │
┌──────────────────────────┼──────────────────────────────────────┐
│                    app.js (앱 로직)                              │
│  • 화면 전환 관리        • 사용자 입력 처리                       │
│  • 학습 상태 관리        • UI 렌더링                             │
└──────────────────────────┼──────────────────────────────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
┌───────┴───────┐  ┌───────┴───────┐  ┌───────┴───────┐
│   data.js     │  │  storage.js   │  │  version.js   │
│ 데이터 로딩/  │  │ 로컬 저장소   │  │ 버전 관리/    │
│ 처리/TTS      │  │ 관리          │  │ 마이그레이션  │
└───────┬───────┘  └───────┬───────┘  └───────────────┘
        │                  │
┌───────┴───────┐  ┌───────┴───────────────────────────┐
│data.bundle.js │  │         localStorage              │
│ (정적 데이터) │  │  ┌─────────┐  ┌─────────────────┐ │
└───────────────┘  │  │progress │  │customCategories │ │
                   │  │settings │  │disabledCategories│ │
                   │  │stats    │  │backupInfo       │ │
                   │  └─────────┘  └─────────────────┘ │
                   └──────────────────────────────────┘
```

### 데이터 흐름도

```
┌─────────────────────────────────────────────────────────────────┐
│                        앱 시작                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ 1. Storage.init()                                               │
│    ├─ recoverTempData(): 이전 세션 임시 데이터 복구              │
│    ├─ loadProgress(): 학습 진도 로드                            │
│    ├─ loadSettings(): 설정 로드                                 │
│    ├─ loadStats(): 통계 로드                                    │
│    ├─ loadCustomCategories(): 사용자 카테고리 로드              │
│    └─ checkAndWarnCorruptedData(): 손상 데이터 경고             │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ 2. VocabData.loadAll()                                          │
│    ├─ DATA_BUNDLE에서 정적 데이터 로드                          │
│    └─ loadCustomCategories(): Storage의 사용자 카테고리 로드     │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ 3. initApp()                                                    │
│    ├─ validateStoredCategory(): 저장된 카테고리 유효성 검사     │
│    ├─ renderCategories(): 카테고리 목록 렌더링                  │
│    └─ renderProgress(): 학습 진행률 렌더링                      │
└─────────────────────────────────────────────────────────────────┘
```

### 데이터 보호 메커니즘

VocabMaster는 **Write-Verify 패턴**과 **다중 백업 시스템**으로 데이터 안전성을 보장합니다.

#### Write-Verify 패턴

저장 시 무결성을 검증하는 패턴입니다:

```
┌──────────────────────────────────────────────────────────────────┐
│                    Write-Verify 저장 흐름                         │
├──────────────────────────────────────────────────────────────────┤
│  1. JSON 직렬화 (serialize)                                      │
│  2. localStorage에 쓰기                                          │
│  3. 다시 읽어오기 + JSON 파싱 검증                               │
│  4. 검증 성공 → 백업 데이터 갱신                                  │
│  5. 검증 실패 → 백업에서 자동 복구                               │
└──────────────────────────────────────────────────────────────────┘
```

#### 저장소 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                    localStorage (영구)                           │
├─────────────────────────────────────────────────────────────────┤
│  Main Data          │  Backup Data                              │
│  ─────────────────  │  ───────────────────────────────          │
│  progress           │  progress_backup                          │
│  stats              │  stats_backup                             │
│  custom_categories  │  custom_categories_backup                 │
│  settings           │  (백업 없음)                               │
└─────────────────────┴───────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                   sessionStorage (세션)                          │
├─────────────────────────────────────────────────────────────────┤
│  temp: 실시간 진행 스냅샷 (탭이 열려있는 동안 유지)              │
└─────────────────────────────────────────────────────────────────┘
```

#### 복구 우선순위

데이터 로드 시 다음 순서로 복구를 시도합니다:

```
┌─────────────────────────────────────────────────────────────────┐
│                    복구 우선순위                                 │
├─────────────────────────────────────────────────────────────────┤
│  1순위: Main 데이터 (localStorage 메인 키)                       │
│  2순위: Backup 데이터 (localStorage 백업 키)                     │
│  3순위: Temp 데이터 (sessionStorage 임시 키)                     │
│  4순위: 복구 불가 모달 표시 (사용자 선택 필요)                   │
└─────────────────────────────────────────────────────────────────┘
```

#### 복구 불가 모달

모든 복구가 실패한 경우에만 표시됩니다 (신규 사용자에게는 표시 안 함):
- **백업 가져오기**: 이전에 내보낸 JSON 파일에서 복원
- **초기 상태로 시작**: 새로 시작 (모든 진행 초기화)

#### 개발자 디버그 모드

설정에서 "개발자 옵션 보기"를 클릭하면 디버그 모드를 활성화할 수 있습니다:
- 데이터 복구 알림 표시
- Write-Verify 패턴 실패 감지
- 테스트 페이지 및 아키텍처 페이지 링크 활성화

#### 멀티탭 동기화

여러 탭에서 동시에 앱을 사용할 때 데이터 충돌을 방지합니다:

| 기능 | 설명 |
|------|------|
| **Storage 이벤트 리스닝** | 다른 탭에서 localStorage 변경 시 자동 감지 및 동기화 |
| **Read-Modify-Write 패턴** | 저장 전 최신 데이터 읽기 → 머지 → 저장 |
| **높은 상태 유지** | 동일 단어의 학습 상태가 충돌 시 더 높은 상태 유지 |
| **UI 자동 갱신** | 데이터 동기화 후 화면 자동 업데이트 |

#### 데이터 압축 (LZ-String)

localStorage 용량 최적화를 위한 선택적 데이터 압축 기능:

| 기능 | 설명 |
|------|------|
| **LZ-String 압축** | UTF-16 최적화 압축으로 50~90% 용량 절감 |
| **자동 형식 감지** | 로드 시 JSON/압축 형식 자동 감지 및 해제 |
| **선택적 활성화** | 설정에서 압축 사용 여부 선택 가능 |
| **실시간 마이그레이션** | 압축 설정 변경 시 기존 데이터 자동 변환 |
| **압축률 표시** | 설정에서 현재 압축률 확인 가능 |

```
압축 형식: 'LZ:' + LZString.compressToUTF16(JSON)
JSON 형식: '{' 또는 '[' 로 시작
→ 로드 시 자동 감지하여 적절한 방식으로 해제
```

#### 저장소 용량 관리

localStorage의 제한된 용량(5MB)을 효율적으로 관리합니다:

| 기능 | 설명 |
|------|------|
| **용량 모니터링** | 설정에서 현재 저장소 사용량 실시간 표시 |
| **용량 경고** | 70% 이상 노란색, 90% 이상 빨간색 경고 |
| **85% 한계** | 저장소 85% 초과 시 새 단어 추가 차단 |
| **대량 가져오기 검사** | 가져오기 전 예상 용량 미리 계산 |
| **상세 통계** | 단어 데이터 vs 학습 상태 비율 분석 |

```
용량 구성:
- 단어 데이터: ~500 bytes/단어
- 학습 상태: ~50 bytes/단어
- 비율: 단어 데이터가 학습 상태의 약 10배
- 백업 포함 시 2배 (메인 + 백업)
```

**데이터 사용량 vs 압축률 용량 차이:**

설정 화면에서 **데이터 사용량**과 **압축률에 표시된 용량**이 다를 수 있습니다:

| 항목 | 포함 데이터 | 설명 |
|------|-------------|------|
| **데이터 사용량** | 전체 | 메인 + 백업 + 설정 + 기타 모든 데이터 |
| **압축률 용량** | 메인만 | progress, stats, custom_categories만 계산 |

이 차이는 VocabMaster의 **이중 백업 시스템** 때문입니다. 데이터 안전을 위해 메인 데이터와 백업 데이터를 함께 저장하므로, 실제 저장소 사용량은 메인 데이터의 약 **2배**가 됩니다.

#### 설정 초기화

설정을 기본값으로 복원하는 기능:

- **초기화 대상**: 다크모드, 발음표시, 백업알림, 압축설정, UI설정
- **유지 항목**: 학습 진도, 통계, 사용자 카테고리
- **설정 > 설정 초기화** 버튼으로 실행

### 주요 모듈

| 모듈 | 역할 | 주요 함수 |
|------|------|----------|
| **app.js** | UI/UX 및 앱 로직 | showView(), updateFlashcard(), startQuiz() |
| **data.js** | 데이터 로딩/처리/TTS | loadAll(), getWordsByCategory(), speak() |
| **storage.js** | 로컬 저장소 관리 | init(), saveProgress(), importData() |
| **version.js** | 버전 관리/마이그레이션 | compare(), migrate(), isCompatible() |

### 알려진 한계점

| 한계점 | 설명 | 현재 상태 |
|--------|------|----------|
| sessionStorage 휘발성 | 탭 닫으면 임시 데이터 손실 | ✅ Main+Backup 이중 백업으로 완화 |
| localStorage 손상 | 브라우저/확장프로그램 간섭 | ✅ Write-Verify 패턴으로 자동 복구 |
| 멀티탭 데이터 충돌 | 여러 탭에서 동시 편집 시 | ✅ Storage 이벤트 + Read-Modify-Write |
| localStorage 용량 제한 | 브라우저별 5~10MB | ✅ LZ-String 압축으로 50~90% 용량 절감 |
| 오프라인 동기화 없음 | 여러 기기 간 동기화 불가 | ⚠️ 클라우드 동기화 (향후)

## 테스트

### Node.js 단위 테스트

데이터 백업/복구 핵심 로직을 Node.js 환경에서 테스트할 수 있습니다.

#### 테스트 기술

- **localStorage/sessionStorage 모킹**: 브라우저 API를 Node.js에서 시뮬레이션
- **핵심 로직 추출**: storage.js의 Write-Verify 패턴과 복구 로직을 독립적으로 테스트
- **시나리오 기반 테스트**: 실제 발생 가능한 데이터 손상 케이스 재현

#### 테스트 실행

```bash
cd vocab-master
node scripts/testDataRecovery.js
```

#### 테스트 케이스

| 테스트 | 설명 | 검증 항목 |
|--------|------|----------|
| 정상 저장 | Write-Verify 패턴 동작 | Main/Backup 동일 데이터 저장 |
| Main 손상 복구 | Main 데이터 손상 시 | Backup에서 자동 복구 |
| Main+Backup 손상 | 둘 다 손상 시 | Temp(sessionStorage)에서 복구 |
| 전체 손상 | 모든 저장소 손상 | hadData=true → 모달 표시 |
| 신규 사용자 | 데이터 없음 | hadData=false → 모달 미표시 |
| 연속 저장 | 여러 번 저장 후 손상 | 마지막 정상 백업에서 복구 |
| Stats 복구 | 학습 통계 손상 | Backup에서 복구 |
| Categories 복구 | 사용자 카테고리 손상 | Backup에서 복구 |
| **Read-Modify-Write** | 멀티탭 충돌 시뮬레이션 | 모든 탭의 변경사항 보존 |
| **Progress 머지** | 상태 충돌 시 | 더 높은 학습 상태 유지 |
| **LZ-String 압축** | 압축 저장/로드 | 데이터 무결성 유지 |
| **자동 형식 감지** | JSON/압축 혼용 | 두 형식 모두 정상 로드 |
| **압축률 계산** | 1000개 단어 테스트 | 약 91% 용량 절감 확인 |

#### 테스트 구성

```
scripts/testDataRecovery.js
├── MockStorage 클래스      # localStorage/sessionStorage 모킹
├── TestStorage 객체        # 핵심 로직 (saveWithBackup, loadWithRecovery)
└── 테스트 케이스 10개      # 백업/복구/멀티탭 시나리오 검증
```

### 브라우저 테스트

설정 > 개발자 옵션 > 디버그 모드 활성화 후 **test.html** 페이지에서 실제 브라우저 환경 테스트:

- 저장소 상태 확인 (Main/Backup/Temp)
- 의도적 데이터 손상 테스트
- 복구 시뮬레이션
- Write-Verify 패턴 검증

## PWA 설치 방법

### Android (Chrome)
1. Chrome 브라우저로 웹사이트 접속
2. 주소창 오른쪽의 설치 버튼 클릭 또는 메뉴(⋮) > "앱 설치" 선택
3. "설치" 클릭

### iOS (Safari)
1. Safari 브라우저로 웹사이트 접속
2. 공유 버튼(□↑) 탭
3. "홈 화면에 추가" 선택
4. "추가" 탭

### Desktop (Chrome/Edge)
1. 브라우저로 웹사이트 접속
2. 주소창 오른쪽의 설치 아이콘(⊕) 클릭
3. "설치" 클릭

### PWA 아이콘 재생성 (개발자용)
```bash
cd vocab-master
npm install canvas
node scripts/generateIconsCanvas.js
```

## 브라우저 지원

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## 라이선스

이 프로젝트는 학습 목적으로 제작되었습니다.

### 사용 라이브러리

| 라이브러리 | 버전 | 라이선스 | 용도 |
|------------|------|----------|------|
| **LZ-String** | 1.5.0 | MIT | 데이터 압축 (localStorage 최적화) |
| **Mermaid.js** | 10.6.1 | MIT | 아키텍처 문서 다이어그램 |

### 외부 API

| API | 제공자 | 용도 |
|-----|--------|------|
| **Free Dictionary API** | dictionaryapi.dev | 단어 정의, 발음, 예문 조회 (무료) |
| **Web Speech API** | 브라우저 내장 | TTS 발음 재생 |

### MIT 라이선스

LZ-String과 Mermaid.js는 MIT 라이선스로 제공되어 상업적 사용이 가능합니다.
